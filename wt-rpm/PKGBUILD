# Maintainer: StoneCold <forumi0721[at]gmail[dot]com>

pkgname=("wt-rpm")
pkgver=0.1
pkgrel=1
pkgdesc="Remote Power Managemant"
arch=("armv6h" "armv7h")
url="https://gitorious.org/wt-rpm"
license=("GPL")
depends=("wt" "wiringpi" "boost-libs" "liboping")
makedepends=("wt" "wiringpi" "boost" "cmake" "liboping")
install="${pkgname}.install"
source=(
	"${pkgname}.tar.xz"
	"${pkgname}.json"
)
md5sums=(
	"SKIP"
	"SKIP"
)

build() {
	cd "${srcdir}/${pkgname}"
	mkdir -p build
	cd build
	cmake .. -DCMAKE_INSTALL_PREFIX="${pkgdir}/usr" -DUSE_CON_HTTP=ON -USE_RASPRPM=ON -DUSE_DUMMY_RPM=ON -DUSE_PING=ON
	make
}

package() {
	cd "${srcdir}/${pkgname}/build"
	make install

	install -dm755 "${pkgdir}/usr/share/wtrpm"
	install -Dm644 "${srcdir}/${pkgname}/imgs/ping.png" "${pkgdir}/usr/share/wtrpm/"
	install -Dm644 "${srcdir}/${pkgname}/imgs/green_light.png" "${pkgdir}/usr/share/wtrpm/"
	install -Dm644 "${srcdir}/${pkgname}/imgs/off_light.png" "${pkgdir}/usr/share/wtrpm/"
	install -Dm644 "${srcdir}/${pkgname}/imgs/power-button.png" "${pkgdir}/usr/share/wtrpm/"

	install -dm755 "${pkgdir}/usr/lib/systemd/system"
	install -Dm644 "${srcdir}/${pkgname}/systemd/wtrpm.service" "${pkgdir}/usr/lib/systemd/system/"

	install -dm755 "${pkgdir}/etc"
	install -Dm644 "${srcdir}/wt-rpm.json" "${pkgdir}/etc/"
}
